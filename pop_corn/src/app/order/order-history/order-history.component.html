<div class="page-container">
  <h1>Meus Pedidos</h1>

  <div class="no-orders" *ngIf="myOrders().length === 0">
    <p>Você ainda não fez nenhum pedido.</p>
    <button (click)="router.navigate(['/'])">Ver filmes em cartaz</button>
  </div>

  <div class="orders-list" *ngIf="myOrders().length > 0">
    <div class="order-card" *ngFor="let order of myOrders()">
      <!-- CABEÇALHO DO PEDIDO - AGORA COMPLETO -->
      <div class="order-header" (click)="toggleOrderDetails(order.orderId)">
        <div>
          <span class="order-id">Pedido: {{ order.orderId }}</span>
          <span class="order-date">{{ order.orderDate | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
        <span class="order-status" [ngClass]="order.status.replace(' ', '-').toLowerCase()">
          {{ order.status }}
        </span>
      </div>
      
      <!-- Detalhes Expansíveis -->
      <div class="order-details" *ngIf="expandedOrderId() === order.orderId">
        <div class="movie-info">
          <img [src]="order.movieImage" [alt]="order.movieTitle" class="movie-poster">
          <div>
            <h4>{{ order.movieTitle }}</h4>
            <p>{{ order.cinemaName }}</p>
            <p>Sessão: {{ order.sessionTime }}</p>
          </div>
        </div>

        <div class="details-section">
          <h5>Ingressos ({{ getTicketCount(order.ticketOrder) }})</h5>
          <p>Lugares: {{ getSeatsText(order.selectedSeats) }}</p>
        </div>

        <div class="details-section" *ngIf="order.bomboniereOrder.length > 0">
          <h5>Bomboniere ({{ getBomboniereCount(order.bomboniereOrder) }})</h5>
          <ul>
            <li *ngFor="let item of order.bomboniereOrder">
              {{ item.quantity }}x {{ item.product.name }}
            </li>
          </ul>
        </div>
      </div>

      <!-- RODAPÉ DO PEDIDO - AGORA COMPLETO -->
      <div class="order-footer">
        <div class="total-price">
            <span>TOTAL</span>
            <span>{{ order.totalPrice | currency:'BRL' }}</span>
        </div>
        <button
          *ngIf="order.status === 'Aguardando Pagamento'"
          (click)="cancelOrder(order.orderId)"
          class="cancel-button">
            Cancelar Pedido
        </button>
      </div>
    </div>
  </div>
</div>
